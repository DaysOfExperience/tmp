![image-20250413201556871](C:\Users\yangzilong\Desktop\markdown\CS\Linux网络\image-20250413201556871.png)

# 协议:(

**协议，即是约定，是计算机网络中进行<u>数据交换</u>而建立的规则、标准或约定的集合。**

计算机之间的传输媒介是光信号和电信号. 通过 "频率" 和 "强弱" 来表示 0 和 1 这样的信息. 要想传递各种不同的信息, 就需要约定好双方的数据格式.

计算机生产厂商有很多;  计算机操作系统, 也有很多;  计算机网络硬件设备, 还是有很多;  如何让这些不同厂商之间生产的计算机能够相互顺畅的通信? 就需要有人站出来, 约定一个共同的标准,  大家都来遵守, 这就是网络协议;

# 网络协议:(

**协议分层**

在网络通信中，因为通信是个极为复杂的过程，它包含了很多步骤，各个步骤之间又存在着许多关联。
所以为了将问题简单化，按照服务、协议、接口等将复杂的通信划分成层次结构，通过封装的方式，将底层的实现封装为接口提供给上层，上层也不关心底层的实现，只管去用。把原来的一个大问题，划分为一个一个的小问题，每一层分工明确，形成标准化的结构。这样不仅灵活性高，之间的耦合度也降低了，可维护性和实现的难度也得到了优化。

**常见的层次模型有两种，一种是OSI七层模型，一种是TCP/IP五层模型（四层模型）。**

## OSI七层模型:(

- OSI（Open System Interconnection，开放系统互连）七层网络模型称为开放式系统互联参考模型， **是一个逻辑上的定义和规范;**

- 把**网络从逻辑上分为了7层**. 每一层都有相关、相对应的物理设备. 比如路由器，交换机等;

- OSI 七层模型是一种框架性的设计方法，其最主要的**功能就是帮助不同类型的主机实现数据传输;**  它的最大优点是将服务、接口和协议这三个概念明确地区分开来，概念清楚，理论也比较完整. 通过七个层次化的结构模型使不同的系统不同的网络之间实现可靠的通讯;

- **OSI七层模型自上而下分别是：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层**

- 应用层：网络服务与最终用户的一个接口
  表示层：数据的表示、安全、压缩
  会话层：建立、管理、终止会话
  传输层：负责进程之间的数据传输
  网络层：负责地址管理和路由选择
  数据链路层：负责相邻设备之间的数据传输
  物理层：负责物理光电信号的传输

  但是这种模型既复杂又不实用，因为他把功能相近的应用层，表示层和会话层分开实现，所以现在大部分都使用将这三层合为一体的TCP/IP五层模型。


## TCP/IP五层(或四层)模型

> TCP/IP是一组协议的代名词，它还包括许多协议，组成了TCP/IP协议簇. 
>
> TCP/IP通讯协议采用了5层的层级结构，每一层都呼叫它的下一层所提供的网络来完成自己的需求.

**在TCP/IP五层模型中，他将OSI七层模型中功能相近的应用层，表示层和会话层合并为应用层。**

> 应用层: **负责应用程序间的数据沟通**，如简单电子邮件传输（SMTP）、文件传输协议（FTP）、网络远程访问协议（Telnet）等. **我们的网络编程主要就是针对应用层.**
>
> 传输层: **负责进程之间的数据传输**. 如传输控制协议 (TCP), **能够确保数据可靠的从源主机发送到目标主机.** 
>
> 网络层: **负责终端节点之间的通信（点对点）, 包括负责地址管理和路由选择**. 例如在IP协议中, 通过IP地址来标识一台主机, 并通过路由表的方式规划出两台主机之间的数据传输的线路(路由). 路由器(Router)工作在网路层. 
>
> 数据链路层: **负责相邻设备之间的数据帧的传送和识别**. 例如**网卡设备的驱动**、帧同步(就是说从网线上检测到什么信号算作新帧的开始)、冲突检测(如果检测到冲突就自动重发)、数据差错校验等工作. 有以太网、令牌环网, 无线LAN等标准. 交换机(Switch)工作在数据链路层. 
>
> 物理层: 负责光/电信号的传输. 比如现在以太网通用的网线(双绞线)、早期以太网采用的的同轴电缆 (现在主要用于有线电视)、光纤, 现在的<u>wifi无线网使用电磁波</u>等都属于物理层的概念。物理层的能力决定了最大传输速率、传输距离、抗干扰性等. 集线器(Hub)工作在物理层. 

![image-20231118175725470](https://cdn.jsdelivr.net/gh/DaysOfExperience/blogImage@main/img/image-20231118175725470.png)

# 数据包封装和分用

数据包利用网络在不同设备之间传输时，**为了可靠和准确地发送到目的地**，并且**高效地利用传输资源**（传输设备和传输线路），事先要对数据包进行拆分和打包，在所发送的数据包上附加上目标地址, 本地地址(准确地)，以及一些用于纠错的字节(安全/可靠)，安全性和可靠性较高时，还要进行加密处理(安全/可靠/保密)等等。**这些操作就叫数据封装**。**而对数据包进行处理时通信双方所遵循和协商好的规则就是协议。**与邮寄物品相比，数据包本身就如同物品，而封装就如同填写各种邮寄信息，协议就是如何填写信息的规定。

不同的协议层对数据包有不同的称谓，在传输层叫做段(segment)，在网络层叫做数据报 (datagram)，	在链路层叫做帧(frame).

应用层数据通过协议栈发到网络上时，每层协议都要加上一个**数据首部**(header)，称为**封装** (Encapsulation)。首部信息中包含了一些类似于首部有多长, 载荷(payload)有多长, 上层协议是什么等信息

数据封装成帧后发到传输介质上（以太网/令牌环），到达目的主机后每层协议再剥掉相应的首部，根据首部中的 "上层协议 "字段将数据交给对应的上层协议处理。

## 数据封装的过程

![image-20231118180138319](https://cdn.jsdelivr.net/gh/DaysOfExperience/blogImage@main/img/image-20231118180138319.png)

## 数据分用的过程

![image-20231118180243634](https://cdn.jsdelivr.net/gh/DaysOfExperience/blogImage@main/img/image-20231118180243634.png)

**分用**很简单，就是按照封装的顺序，将封装的首部和尾部去掉，恢复成原来的数据。其实就是封装的反操作，又称为解封装

# 网络中的地址管理

在网络通信中，每台通信的主机之间都应该有属于自己的标志，就如同名字一样，只有拥有这种标志，才能够进行交流。就好比你想要在茫茫人海中找到一个人，就得知道他的名字，才能找到这个人。
而在网络通信中，也不例外。

**IP地址**

IP地址就是网络中**主机的唯一标识**，无论哪个主机与哪个主机之间进行通信，都需要用IP地址来进行定位。

- 在通信时，每条数据中都会包含源端IP地址和对端IP地址，他们指定了通信的两个对象。
- IP地址是在IP协议中, 用来标识网络中不同主机的地址;

- 对于IPv4来说, IP地址是一个4字节, uint32_t类型的数据, 无符号32位的整数; 
- 我们通常也使用 "点分十进制" 的字符串表示IP地址, 例如 192.168.0.1; 用点分割的每一个数字表示一个字节, 范围是 0 - 255;

**端口号**

**端口号则是主机上进程的唯一标识**，是传输层协议的内容. 在编写程序时，需要告知计算机应该处理发往哪个端口的数据。

一个端口只能被一个进程占用，但是一个进程可以同时使用多个端口。 传输层协议(TCP和UDP)的数据段中有两个端口号, 分别叫做源端口号和目的端口号. 就是在描述 "数据是哪个进程发的, 要发给哪个进程";

端口号是uint16_t，也就是无符号16位的整数。

IP地址 + 端口号能够标识网络上的某一台主机的某一个进程;

**MAC地址**

**MAC地址用来识别数据链路层中相连的网络节点;** 通常也被认为是物理地址

MAC地址长度为48位, 即6个字节. 一般用16进制数字加上冒号的形式来表示(例如: 08:00:27:03:fb:19) 

# 网络字节序与主机字节序

在网络通信时，还需要注意字节序的问题。
**字节序就是CPU对数据在内存中以字节为单位的存取顺序，也就是我们通常所说的大端小端问题。**

大端存储模式：是指数据的低位保存在内存的高地址中，而数据的高位，保存在内存的低地址中。 低位高地址, 高位低地址
小端存储模式：是指数据的低位保存在内存的低地址中，而数据的高位，保存在内存的高地址中。 低位低地址, 高位高地址

在网络通信中，**网络字节序采用大端的存储模式**(低位高地址, 高位低地址)，而主机字节序根据主机不同也不一样，我们现在的家用机一般都是小端，但网络上的通信不能确保主机字节序的唯一性，因为受众是整个网络，而一旦通信的双方主机字节序不同，就会造成通信时的数据二义，所以需要**确保字节序相同，就需要在通信时将主机字节序转换为通用的网络字节序。**

# 网络传输流程图

**同一个网段内的两台主机进行文件传输**

![image-20231118181948986](https://cdn.jsdelivr.net/gh/DaysOfExperience/blogImage@main/img/image-20231118181948986.png)

**跨网段的主机的文件传输**

数据从一台计算机到另一台计算机传输过程中要经过一个或多个路由器

![image-20231118182124068](https://cdn.jsdelivr.net/gh/DaysOfExperience/blogImage@main/img/image-20231118182124068.png)





